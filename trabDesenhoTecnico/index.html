<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Visualizador de Imagem — Glass UI</title>

<style>
/* ------------------------------
     ESTILO GLASSMORPHISM PREMIUM
--------------------------------*/

@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;600;700&display=swap');

:root {
    --glass-bg: rgba(255, 255, 255, 0.18);
    --glass-border: rgba(255, 255, 255, 0.4);
    --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    --text-color: #ffffff;
    --accent: #00f2ff;
    --accent-strong: #00c0cc;
}

body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 40px 20px;
    background: linear-gradient(135deg, #0b0f2f, #0f3b52, #0b0f2f);
    color: var(--text-color);
    backdrop-filter: blur(10px);
}

/* ----------- CABEÇALHO ----------- */
#titleSite {
    background: var(--glass-bg);
    backdrop-filter: blur(15px);
    border-radius: 16px;
    padding: 25px 40px;
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
}

#titleSite h2 {
    margin: 0;
    font-size: 1.5em;
    font-weight: 600;
}

#titleSite ul {
    display: flex;
    list-style: none;
    gap: 20px;
    margin-top: 12px;
    padding: 0;
    font-weight: 300;
    opacity: 0.85;
}

/* ----------- TÍTULOS DAS SEÇÕES ----------- */
h2 {
    margin-top: 45px;
    font-size: 1.6em;
    font-weight: 600;
    color: var(--accent);
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
}

/* ----------- CONTAINERS DE CONTEÚDO ----------- */
.container {
    margin-top: 20px;
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    padding: 30px;
    border-radius: 18px;
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
}

label {
    font-weight: 400;
}

/* ----------- IMAGENS ----------- */
img {
    max-width: 100%;
    border-radius: 14px;
    margin-top: 15px;
    border: 1px solid rgba(255, 255, 255, 0.25);
}

/* ----------- INPUT FILE ----------- */
#imageInput {
    margin-top: 12px;
    padding: 10px;
    border-radius: 10px;
    background: rgba(255,255,255,0.2);
    border: 1px solid var(--glass-border);
    color: white;
    cursor: pointer;
}

/* ----------- BOTÕES ----------- */
button {
    margin-top: 15px;
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    background: linear-gradient(135deg, var(--accent), var(--accent-strong));
    color: black;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s ease;
    box-shadow: 0 0 10px rgba(0,255,255,0.4);
}

button:hover:not(:disabled) {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(0,255,255,0.7);
}

button:disabled {
    background: gray;
    cursor: not-allowed;
}

/* ----------- REDUÇÕES ----------- */
.result {
    margin-top: 20px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
}

.result-item {
    background: rgba(255,255,255,0.12);
    border: 1px solid var(--glass-border);
    padding: 15px;
    border-radius: 12px;
    box-shadow: var(--glass-shadow);
    text-align: center;
}

.result-item img {
    width: auto !important;
    max-height: 200px;
}

/* ----------- HISTOGRAMAS ----------- */
canvas {
    margin-top: 10px;
    border-radius: 12px;
    background: rgba(255,255,255,0.1);
    border: 1px solid var(--glass-border);
}

/* ----------- TEXTO DENTRO DOS CARDS ----------- */
#statsR, #statsG, #statsB, #bitsInfo {
    background: rgba(255,255,255,0.15);
    padding: 12px;
    border-radius: 10px;
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
}

</style>
</head>
<body>

<!-- CABEÇALHO -->
<div id="titleSite">
    <h2>Trabalho de Desenho Técnico — Engenharia da Computação</h2>
    <ul>
        <li>Arthur Romero Rossi</li>
        <li>Gabriel Henrique Meneghelli</li>
        <li>Maria Fernanda Pires de Oliveira</li>
    </ul>
</div>

<!-- SEÇÃO 1 -->
<h2>1º — Carregar e Visualizar Imagem</h2>
<div class="container">
    <label>Selecione uma imagem:</label>
    <input type="file" id="imageInput" accept="image/png, image/jpeg, image/bmp">

    <p id="dimensions"></p>
    <img id="preview" src="">
</div>

<!-- SEÇÃO 2 -->
<h2>2º — Redução da Imagem (75%, 50%, 25%)</h2>
<div class="container">
    <p>As reduções aparecerão automaticamente após selecionar a imagem.</p>
    <div class="result" id="result"></div>
</div>

<!-- SEÇÃO 3 -->
<h2>3º — Conversão de Formato para WEBP</h2>
<div class="container">
    <p><strong>Tamanho original:</strong> <span id="originalSize">---</span></p>
    <p><strong>Tamanho WEBP:</strong> <span id="webpSize">---</span></p>

    <img id="webpPreview">
    <button id="downloadWebp" disabled>Baixar WEBP</button>
</div>

<!-- SEÇÃO 4 -->
<h2>4º — Espelhamento Vertical</h2>
<div class="container">
    <p>A imagem espelhada aparecerá abaixo automaticamente.</p>
    <img id="flipPreview">
    <button id="downloadFlip" disabled>Baixar Espelhamento</button>
</div>

<!-- SEÇÃO 5 -->
<h2>5º — Tons de Cinza</h2>
<div class="container">
    <p>A imagem em tons de cinza aparecerá abaixo automaticamente.</p>
    <img id="grayPreview">
    <button id="downloadGray" disabled>Baixar Tons de Cinza</button>
</div>

<!-- SEÇÃO 6 -->
<h2>6º — Histogramas RGB + Estatísticas</h2>
<div class="container">
    <div style="display:flex; flex-wrap:wrap; gap:20px;">
        <div>
            <h3>Histograma R</h3>
            <canvas id="histR" width="300" height="150"></canvas>
            <p id="statsR"></p>
        </div>
        <div>
            <h3>Histograma G</h3>
            <canvas id="histG" width="300" height="150"></canvas>
            <p id="statsG"></p>
        </div>
        <div>
            <h3>Histograma B</h3>
            <canvas id="histB" width="300" height="150"></canvas>
            <p id="statsB"></p>
        </div>
    </div>
</div>

<!-- SEÇÃO 7 -->
<h2>7º — Análise de Bits e Estrutura da Imagem</h2>
<div class="container">
    <p id="bitsInfo"></p>
</div>

    <script>
        const input = document.getElementById("imageInput");
        const preview = document.getElementById("preview");
        const dimensions = document.getElementById("dimensions");
        const resultContainer = document.getElementById("result");

        const originalSizeTxt = document.getElementById("originalSize");
        const webpSizeTxt = document.getElementById("webpSize");
        const webpPreview = document.getElementById("webpPreview");
        const btnDownloadWebp = document.getElementById("downloadWebp");

        const flipPreview = document.getElementById("flipPreview");
        const btnDownloadFlip = document.getElementById("downloadFlip");

        let originalFileSize = 0;

        input.addEventListener("change", function () {
            const file = this.files[0];
            if (!file) return;

            originalFileSize = file.size;
            originalSizeTxt.textContent = formatBytes(originalFileSize);

            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;

                preview.onload = function () {
                    const width = preview.naturalWidth;
                    const height = preview.naturalHeight;

                    dimensions.textContent = `Dimensões: ${width} x ${height} pixels`;

                    gerarReducoes(preview, width, height);
                    converterParaWebp(preview, width, height);
                    gerarEspelhamento(preview, width, height);
                    gerarTonsDeCinza(preview, width, height);
                    gerarHistograma(preview, width, height);
                    analisarImagem(preview, width, height);


                };
            };

            reader.readAsDataURL(file);
        });

        /* ----------- 2. Reduções ----------- */
        function gerarReducoes(img, width, height) {
            resultContainer.innerHTML = "";

            const fatores = [
                { nome: "75%", fator: 0.75 },
                { nome: "50%", fator: 0.50 },
                { nome: "25%", fator: 0.25 }
            ];

            fatores.forEach(item => {
                const novoW = width * item.fator;
                const novoH = height * item.fator;

                const canvas = document.createElement("canvas");
                canvas.width = novoW;
                canvas.height = novoH;

                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, novoW, novoH);

                const newImg = document.createElement("img");
                newImg.src = canvas.toDataURL("image/png");

                const div = document.createElement("div");
                div.className = "result-item";

                const p = document.createElement("p");
                p.className = "dim";
                p.textContent = `Redução ${item.nome}: ${Math.round(novoW)} x ${Math.round(novoH)} pixels`;

                div.appendChild(p);
                div.appendChild(newImg);

                resultContainer.appendChild(div);
            });
        }

        /* ----------- 3. Converter para WEBP ----------- */
        function converterParaWebp(img, w, h) {
            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, w, h);

            const webpData = canvas.toDataURL("image/webp", 0.8);

            webpPreview.src = webpData;

            const webpSize = Math.round((webpData.length * 3) / 4);
            webpSizeTxt.textContent = formatBytes(webpSize);

            btnDownloadWebp.disabled = false;
            btnDownloadWebp.onclick = function () {
                const a = document.createElement("a");
                a.href = webpData;
                a.download = "imagem_convertida.webp";
                a.click();
            };
        }

        /* ----------- 4. Espelhamento Vertical ----------- */
        function gerarEspelhamento(img, w, h) {
            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");

            ctx.translate(w, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(img, 0, 0, w, h);

            const flippedData = canvas.toDataURL("image/png");

            flipPreview.src = flippedData;

            btnDownloadFlip.disabled = false;
            btnDownloadFlip.onclick = function () {
                const a = document.createElement("a");
                a.href = flippedData;
                a.download = "imagem_espelhada.png";
                a.click();
            };
        }

        /* ----------- formatar tamanho ----------- */
        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + " B";
            else if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
            else return (bytes / (1024 * 1024)).toFixed(1) + " MB";
        }

        /* ----------- 5. Tons de Cinza ----------- */
        function gerarTonsDeCinza(img, w, h) {
            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, w, h);

            let imgData = ctx.getImageData(0, 0, w, h);
            let data = imgData.data;

            // Converter pixel por pixel
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];

                // fórmula luminance
                const gray = 0.299 * r + 0.587 * g + 0.114 * b;

                data[i] = data[i + 1] = data[i + 2] = gray;
            }

            ctx.putImageData(imgData, 0, 0);

            const grayData = canvas.toDataURL("image/png");

            const grayPreview = document.getElementById("grayPreview");
            const btnGray = document.getElementById("downloadGray");

            grayPreview.src = grayData;
            btnGray.disabled = false;

            btnGray.onclick = function () {
                const a = document.createElement("a");
                a.href = grayData;
                a.download = "imagem_tons_de_cinza.png";
                a.click();
            };
        }

        /* ----------- 6. HISTOGRAMA RGB + ESTATÍSTICAS ----------- */
        function gerarHistograma(img, w, h) {

            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, w, h);

            let imgData = ctx.getImageData(0, 0, w, h);
            let data = imgData.data;

            // Histograma com 256 posições
            let histR = new Array(256).fill(0);
            let histG = new Array(256).fill(0);
            let histB = new Array(256).fill(0);

            let valoresR = [], valoresG = [], valoresB = [];

            // Preenchendo histogramas
            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];
                let g = data[i + 1];
                let b = data[i + 2];

                histR[r]++; histG[g]++; histB[b]++;
                valoresR.push(r); valoresG.push(g); valoresB.push(b);
            }

            // Funções estatísticas
            function calcularStats(valores) {
                valores.sort((a, b) => a - b);
                let min = valores[0];
                let max = valores[valores.length - 1];

                let media = valores.reduce((a, b) => a + b, 0) / valores.length;

                let mediana = valores.length % 2 === 0 ?
                    (valores[valores.length / 2 - 1] + valores[valores.length / 2]) / 2 :
                    valores[Math.floor(valores.length / 2)];

                let variancia = valores.reduce((acc, val) => acc + Math.pow(val - media, 2), 0) / valores.length;
                let desvio = Math.sqrt(variancia);

                return { min, max, media, mediana, desvio };
            }

            const statsR = calcularStats(valoresR);
            const statsG = calcularStats(valoresG);
            const statsB = calcularStats(valoresB);

            // Escrever estatísticas na tela
            document.getElementById("statsR").innerHTML =
                `Min: ${statsR.min} | Max: ${statsR.max} | Média: ${statsR.media.toFixed(2)}
                <br>Mediana: ${statsR.mediana} | Desvio-padrão: ${statsR.desvio.toFixed(2)}`;

            document.getElementById("statsG").innerHTML =
                `Min: ${statsG.min} | Max: ${statsG.max} | Média: ${statsG.media.toFixed(2)}
                <br>Mediana: ${statsG.mediana} | Desvio-padrão: ${statsG.desvio.toFixed(2)}`;

            document.getElementById("statsB").innerHTML =
                `Min: ${statsB.min} | Max: ${statsB.max} | Média: ${statsB.media.toFixed(2)}
                <br>Mediana: ${statsB.mediana} | Desvio-padrão: ${statsB.desvio.toFixed(2)}`;

            // Função para desenhar histogramas
            function desenharHistograma(id, histData, cor) {
                const canvas = document.getElementById(id);
                const ctxHist = canvas.getContext("2d");

                ctxHist.clearRect(0, 0, canvas.width, canvas.height);

                let maxValor = Math.max(...histData);

                for (let i = 0; i < 256; i++) {
                    let h = (histData[i] / maxValor) * canvas.height;

                    ctxHist.fillStyle = cor;
                    ctxHist.fillRect(i, canvas.height - h, 1, h);
                }
            }

            desenharHistograma("histR", histR, "red");
            desenharHistograma("histG", histG, "green");
            desenharHistograma("histB", histB, "blue");
        }

        /* ----------- 7. ANÁLISE DE BITS E ESTRUTURA ----------- */
        function analisarImagem(img, w, h) {

            // Canvas para obter informações da imagem processada
            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, w, h);

            const imgData = ctx.getImageData(0, 0, w, h);

            // Informações
            const canais = 4; // R, G, B e Alpha (sempre ao usar getImageData)
            const bitsPorCanal = 8;
            const bitsPorPixel = canais * bitsPorCanal;
            const tamanhoMemoria = imgData.data.length; // bytes do buffer RGBA

            const txt = `
                <strong>Profundidade de cor:</strong> ${bitsPorPixel} bits/pixel (${bitsPorCanal} bits por canal)<br>
                <strong>Número de canais:</strong> ${canais} (R, G, B, A)<br>
                <strong>Dimensões:</strong> ${w} × ${h} pixels<br>
                <strong>Tamanho em memória:</strong> ${tamanhoMemoria} bytes
            `;

            document.getElementById("bitsInfo").innerHTML = txt;
        }
    </script>

</body>
</html>
