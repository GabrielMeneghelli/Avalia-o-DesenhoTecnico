<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Visualizador de Imagem</title>

    <style>
    /* Importação da fonte Roboto */
    @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

    /* Variáveis CSS para cores e transições (facilita a manutenção) */
    :root {
        --cor-primaria: #101312; /* Verde Teal mais escuro para botões e destaque */
        --cor-secundaria: #089c90; /* Verde Teal claro para o fundo */
        --cor-fundo-card: #f8f8f8; /* Branco Sujo / Off-White */
        --cor-texto-principal: #1f2937; /* Preto suave */
        --cor-borda-cinza: #e5e7eb; /* Cinza claro para bordas e separadores */
        --sombra-padrao: 0 4px 6px rgba(0, 0, 0, 0.08);
        --transicao-padrao: 0.2s ease-in-out;
    }

    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 40px 20px; /* Padding no body em vez de margin */
        background-color: var(--cor-secundaria);
        color: var(--cor-texto-principal);
        line-height: 1.6;
    }

    /* Estilização da área de cabeçalho (título do trabalho e nomes) */
    #titleSite {
        background: var(--cor-fundo-card);
        padding: 20px 40px;
        border-radius: 12px;
        box-shadow: var(--sombra-padrao);
        margin-bottom: 30px;
        border-left: 8px solid var(--cor-primaria); /* Destaque visual */
    }

    h2 {
        color: var(--cor-primaria);
        font-style: normal; /* Removido o itálico para um visual mais limpo */
        font-weight: 700;
        border-bottom: 2px solid var(--cor-borda-cinza);
        padding-bottom: 10px;
        margin-top: 40px;
    }
    
    #titleSite h2 {
        color: var(--cor-texto-principal);
        border-bottom: none;
        margin-top: 0;
        margin-left: 0 !important;
    }

    /* Lista de nomes */
    #titleSite ul {
        list-style: none;
        padding: 0;
        margin-top: 10px;
        font-size: 0.95em;
        color: #4b5563; /* Cinza mais escuro para o subtexto */
        display: flex;
        gap: 20px;
    }
    #titleSite li {
        border-right: 1px solid var(--cor-borda-cinza);
        padding-right: 20px;
    }
    #titleSite li:last-child {
        border-right: none;
        padding-right: 0;
    }

    label {
        font-weight: 600;
        color: var(--cor-texto-principal);
        display: block; /* Garante que o label ocupe sua própria linha */
        margin-bottom: 5px;
    }

    /* Contêiner principal para cada seção */
    .container {
        margin-top: 20px;
        background-color: var(--cor-fundo-card);
        padding: 30px;
        border-radius: 10px;
        box-shadow: var(--sombra-padrao);
    }

    img {
        max-width: 100%;
        height: auto;
        border: 1px solid var(--cor-borda-cinza);
        border-radius: 8px;
        margin-top: 15px;
        object-fit: contain; /* Garante que a imagem se ajuste sem cortar */
        max-height: 400px; /* Limita a altura das prévias para não ficarem gigantes */
        display: block;
    }
    
    #preview {
        max-height: 500px; /* Permite que a prévia principal seja um pouco maior */
    }

    /* Estilo para a pré-visualização de imagem e input de arquivo */
    #imageInput {
        padding: 8px;
        border: 1px solid var(--cor-borda-cinza);
        border-radius: 5px;
        background-color: white;
    }

   .result {
    margin-top: 20px;
    display: grid;
    /* Layout responsivo melhorado */
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
    gap: 20px;
}

.result-item {
    background: white; /* Fundo branco para os itens internos */
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* Sombra mais suave */
    border: 1px solid var(--cor-borda-cinza);
    /* NOVO: Centraliza o conteúdo (as imagens reduzidas) */
    text-align: center; 
}

.result-item img {
    margin-top: 10px;
    max-height: 200px; 
    
    /* A CORREÇÃO: Força a imagem a usar sua largura natural (a largura reduzida do canvas), 
       e anula o 'max-width: 100%' da regra genérica. */
    width: auto !important; 
    display: inline-block; /* Garante que 'text-align: center' funcione */
}
    .dim {
        font-size: 14px;
        margin: 0 0 10px 0;
        color: #6b7280; /* Cinza para informações secundárias */
        font-weight: 400;
    }

    /* Estilo para todos os botões da página */
    button {
        margin-top: 15px;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        background-color: var(--cor-primaria);
        color: white;
        cursor: pointer;
        font-weight: bold;
        transition: var(--transicao-padrao);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    button:disabled {
        background-color: #9ca3af; /* Cinza para desabilitado */
        cursor: not-allowed;
        box-shadow: none;
    }

    button:hover:not(:disabled) {
        background-color: #0a4f49; /* Cor um pouco mais escura no hover */
        transform: translateY(-1px); /* Pequeno efeito 3D */
    }

    /* Estilos para a seção de Histograma */
    .container h3 {
        color: var(--cor-primaria);
        margin-top: 0;
        font-weight: 500;
        font-size: 1.1em;
    }

    #statsR, #statsG, #statsB, #bitsInfo {
        font-size: 0.9em;
        line-height: 1.5;
        color: #4b5563;
        margin-top: 10px;
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        border: 1px dashed var(--cor-borda-cinza);
    }
    
    #statsR strong, #statsG strong, #statsB strong {
        color: var(--cor-texto-principal);
    }
    
    canvas {
        border: 1px solid var(--cor-borda-cinza) !important;
        border-radius: 5px;
    }
    
    @media (max-width: 600px) {
        body {
            padding: 20px 10px;
        }
        #titleSite ul {
            flex-direction: column;
            gap: 5px;
        }
        #titleSite li {
            border-right: none;
            padding-right: 0;
        }
    }
</style>
</head>
<body>

    <div id="titleSite">
        <h2 style="margin-left: 20px;">Trabalho de Desenho Técnico 2º termo - Engenharia da Computação</h2>
        <ul style="list-style: none;">
            <li>Arthur Romero Rossi</li>
            <li>Gabriel Henrique Meneghelli da Silva</li>
            <li>Maria Fernanda Pires de Oliveira</li>
        </ul>
    </div>

    <!-- Seção 1 -->
    <h2>1º - Carregar e Visualizar Imagem</h2>

    <div class="container">
        <label>Selecione uma imagem:</label><br>
        <input type="file" id="imageInput" accept="image/png, image/jpeg, image/bmp">

        <p id="dimensions"></p>
        <img id="preview" src="" alt="">
    </div>

    <!-- Seção 2 -->
    <h2>2º - Redução da Imagem (75%, 50%, 25%)</h2>

    <div class="container">
        <p>As reduções aparecerão automaticamente após selecionar a imagem.</p>
        <div class="result" id="result"></div>
    </div>

    <!-- Seção 3 -->
    <h2>3º - Conversão de Formato para WEBP</h2>

    <div class="container">
        <p><strong>Tamanho original:</strong> <span id="originalSize">---</span></p>
        <p><strong>Tamanho WEBP:</strong> <span id="webpSize">---</span></p>

        <img id="webpPreview" src="" alt="">

        <button id="downloadWebp" style="
            margin-top: 15px;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: #0e6b62;
            color: white;
            cursor: pointer;
            font-weight: bold;
        " disabled>Baixar WEBP</button>
    </div>

    <!-- Seção 4 -->
    <h2>4º - Operação Geométrica — Espelhamento Vertical</h2>

    <div class="container">
        <p>A imagem espelhada aparecerá abaixo automaticamente.</p>

        <img id="flipPreview" src="" alt="">

        <button id="downloadFlip" style="
            margin-top: 15px;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: #0e6b62;
            color: white;
            cursor: pointer;
            font-weight: bold;
        " disabled>Baixar Espelhamento</button>
    </div>

    <!-- Seção 5 -->
    <h2>5º - Operação de Cores — Tons de Cinza</h2>

    <div class="container">
        <p>A imagem em tons de cinza aparecerá abaixo automaticamente.</p>

        <img id="grayPreview" src="" alt="">

        <button id="downloadGray" style="
            margin-top: 15px;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: #0e6b62;
            color: white;
            cursor: pointer;
            font-weight: bold;
        " disabled>Baixar Tons de Cinza</button>
    </div>

    <!-- Seção 6 -->
    <h2>6º - Histograma RGB + Estatísticas</h2>

    <div class="container">
        <p>Histogramas dos canais R, G e B e estatísticas calculadas automaticamente.</p>

        <div style="display:flex; flex-wrap:wrap; gap:20px;">
            <div>
                <h3>Histograma R</h3>
                <canvas id="histR" width="300" height="150" style="background:white;"></canvas>
                <p id="statsR"></p>
            </div>

            <div>
                <h3>Histograma G</h3>
                <canvas id="histG" width="300" height="150" style="background:white;"></canvas>
                <p id="statsG"></p>
            </div>

            <div>
                <h3>Histograma B</h3>
                <canvas id="histB" width="300" height="150" style="background:white;"></canvas>
                <p id="statsB"></p>
            </div>
        </div>
    </div>

    <!-- Seção 7 -->
    <h2>7º - Análise de Bits e Estrutura da Imagem</h2>

    <div class="container">
        <p>Informações sobre profundidade de cor, canais, dimensões e tamanho em memória.</p>

        <p id="bitsInfo"></p>
    </div>

    <script>
        const input = document.getElementById("imageInput");
        const preview = document.getElementById("preview");
        const dimensions = document.getElementById("dimensions");
        const resultContainer = document.getElementById("result");

        const originalSizeTxt = document.getElementById("originalSize");
        const webpSizeTxt = document.getElementById("webpSize");
        const webpPreview = document.getElementById("webpPreview");
        const btnDownloadWebp = document.getElementById("downloadWebp");

        const flipPreview = document.getElementById("flipPreview");
        const btnDownloadFlip = document.getElementById("downloadFlip");

        let originalFileSize = 0;

        input.addEventListener("change", function () {
            const file = this.files[0];
            if (!file) return;

            originalFileSize = file.size;
            originalSizeTxt.textContent = formatBytes(originalFileSize);

            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;

                preview.onload = function () {
                    const width = preview.naturalWidth;
                    const height = preview.naturalHeight;

                    dimensions.textContent = `Dimensões: ${width} x ${height} pixels`;

                    gerarReducoes(preview, width, height);
                    converterParaWebp(preview, width, height);
                    gerarEspelhamento(preview, width, height);
                    gerarTonsDeCinza(preview, width, height);
                    gerarHistograma(preview, width, height);
                    analisarImagem(preview, width, height);


                };
            };

            reader.readAsDataURL(file);
        });

        /* ----------- 2. Reduções ----------- */
        function gerarReducoes(img, width, height) {
            resultContainer.innerHTML = "";

            const fatores = [
                { nome: "75%", fator: 0.75 },
                { nome: "50%", fator: 0.50 },
                { nome: "25%", fator: 0.25 }
            ];

            fatores.forEach(item => {
                const novoW = width * item.fator;
                const novoH = height * item.fator;

                const canvas = document.createElement("canvas");
                canvas.width = novoW;
                canvas.height = novoH;

                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, novoW, novoH);

                const newImg = document.createElement("img");
                newImg.src = canvas.toDataURL("image/png");

                const div = document.createElement("div");
                div.className = "result-item";

                const p = document.createElement("p");
                p.className = "dim";
                p.textContent = `Redução ${item.nome}: ${Math.round(novoW)} x ${Math.round(novoH)} pixels`;

                div.appendChild(p);
                div.appendChild(newImg);

                resultContainer.appendChild(div);
            });
        }

        /* ----------- 3. Converter para WEBP ----------- */
        function converterParaWebp(img, w, h) {
            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, w, h);

            const webpData = canvas.toDataURL("image/webp", 0.8);

            webpPreview.src = webpData;

            const webpSize = Math.round((webpData.length * 3) / 4);
            webpSizeTxt.textContent = formatBytes(webpSize);

            btnDownloadWebp.disabled = false;
            btnDownloadWebp.onclick = function () {
                const a = document.createElement("a");
                a.href = webpData;
                a.download = "imagem_convertida.webp";
                a.click();
            };
        }

        /* ----------- 4. Espelhamento Vertical ----------- */
        function gerarEspelhamento(img, w, h) {
            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");

            ctx.translate(w, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(img, 0, 0, w, h);

            const flippedData = canvas.toDataURL("image/png");

            flipPreview.src = flippedData;

            btnDownloadFlip.disabled = false;
            btnDownloadFlip.onclick = function () {
                const a = document.createElement("a");
                a.href = flippedData;
                a.download = "imagem_espelhada.png";
                a.click();
            };
        }

        /* ----------- formatar tamanho ----------- */
        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + " B";
            else if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
            else return (bytes / (1024 * 1024)).toFixed(1) + " MB";
        }

        /* ----------- 5. Tons de Cinza ----------- */
        function gerarTonsDeCinza(img, w, h) {
            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, w, h);

            let imgData = ctx.getImageData(0, 0, w, h);
            let data = imgData.data;

            // Converter pixel por pixel
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];

                // fórmula luminance
                const gray = 0.299 * r + 0.587 * g + 0.114 * b;

                data[i] = data[i + 1] = data[i + 2] = gray;
            }

            ctx.putImageData(imgData, 0, 0);

            const grayData = canvas.toDataURL("image/png");

            const grayPreview = document.getElementById("grayPreview");
            const btnGray = document.getElementById("downloadGray");

            grayPreview.src = grayData;
            btnGray.disabled = false;

            btnGray.onclick = function () {
                const a = document.createElement("a");
                a.href = grayData;
                a.download = "imagem_tons_de_cinza.png";
                a.click();
            };
        }

        /* ----------- 6. HISTOGRAMA RGB + ESTATÍSTICAS ----------- */
        function gerarHistograma(img, w, h) {

            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, w, h);

            let imgData = ctx.getImageData(0, 0, w, h);
            let data = imgData.data;

            // Histograma com 256 posições
            let histR = new Array(256).fill(0);
            let histG = new Array(256).fill(0);
            let histB = new Array(256).fill(0);

            let valoresR = [], valoresG = [], valoresB = [];

            // Preenchendo histogramas
            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];
                let g = data[i + 1];
                let b = data[i + 2];

                histR[r]++; histG[g]++; histB[b]++;
                valoresR.push(r); valoresG.push(g); valoresB.push(b);
            }

            // Funções estatísticas
            function calcularStats(valores) {
                valores.sort((a, b) => a - b);
                let min = valores[0];
                let max = valores[valores.length - 1];

                let media = valores.reduce((a, b) => a + b, 0) / valores.length;

                let mediana = valores.length % 2 === 0 ?
                    (valores[valores.length / 2 - 1] + valores[valores.length / 2]) / 2 :
                    valores[Math.floor(valores.length / 2)];

                let variancia = valores.reduce((acc, val) => acc + Math.pow(val - media, 2), 0) / valores.length;
                let desvio = Math.sqrt(variancia);

                return { min, max, media, mediana, desvio };
            }

            const statsR = calcularStats(valoresR);
            const statsG = calcularStats(valoresG);
            const statsB = calcularStats(valoresB);

            // Escrever estatísticas na tela
            document.getElementById("statsR").innerHTML =
                `Min: ${statsR.min} | Max: ${statsR.max} | Média: ${statsR.media.toFixed(2)}
                <br>Mediana: ${statsR.mediana} | Desvio-padrão: ${statsR.desvio.toFixed(2)}`;

            document.getElementById("statsG").innerHTML =
                `Min: ${statsG.min} | Max: ${statsG.max} | Média: ${statsG.media.toFixed(2)}
                <br>Mediana: ${statsG.mediana} | Desvio-padrão: ${statsG.desvio.toFixed(2)}`;

            document.getElementById("statsB").innerHTML =
                `Min: ${statsB.min} | Max: ${statsB.max} | Média: ${statsB.media.toFixed(2)}
                <br>Mediana: ${statsB.mediana} | Desvio-padrão: ${statsB.desvio.toFixed(2)}`;

            // Função para desenhar histogramas
            function desenharHistograma(id, histData, cor) {
                const canvas = document.getElementById(id);
                const ctxHist = canvas.getContext("2d");

                ctxHist.clearRect(0, 0, canvas.width, canvas.height);

                let maxValor = Math.max(...histData);

                for (let i = 0; i < 256; i++) {
                    let h = (histData[i] / maxValor) * canvas.height;

                    ctxHist.fillStyle = cor;
                    ctxHist.fillRect(i, canvas.height - h, 1, h);
                }
            }

            desenharHistograma("histR", histR, "red");
            desenharHistograma("histG", histG, "green");
            desenharHistograma("histB", histB, "blue");
        }

        /* ----------- 7. ANÁLISE DE BITS E ESTRUTURA ----------- */
        function analisarImagem(img, w, h) {

            // Canvas para obter informações da imagem processada
            const canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, w, h);

            const imgData = ctx.getImageData(0, 0, w, h);

            // Informações
            const canais = 4; // R, G, B e Alpha (sempre ao usar getImageData)
            const bitsPorCanal = 8;
            const bitsPorPixel = canais * bitsPorCanal;
            const tamanhoMemoria = imgData.data.length; // bytes do buffer RGBA

            const txt = `
                <strong>Profundidade de cor:</strong> ${bitsPorPixel} bits/pixel (${bitsPorCanal} bits por canal)<br>
                <strong>Número de canais:</strong> ${canais} (R, G, B, A)<br>
                <strong>Dimensões:</strong> ${w} × ${h} pixels<br>
                <strong>Tamanho em memória:</strong> ${tamanhoMemoria} bytes
            `;

            document.getElementById("bitsInfo").innerHTML = txt;
        }
    </script>

</body>
</html>
